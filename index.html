<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GTA-RP Trauma Triage ‚Äî Pr√©-diagnostic</title>
  <style>
    :root {
      --bg:#0f172a;--card:#0b1220;--text:#e2e8f0;--muted:#94a3b8;
      --accent:#6366f1;--accent-2:#22c55e;--warn:#f59e0b;--danger:#ef4444;
      --border:#1f2937;--chip:#111827;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui, sans-serif;background:#0b1020;color:var(--text)}
    .container{max-width:980px;margin:40px auto;padding:0 16px}
    .card{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:18px;padding:18px}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}
    label{font-size:14px;color:var(--muted);display:block;margin-bottom:6px}
    textarea,select,input[type=text]{width:100%;background:#0a0f1b;color:var(--text);border:1px solid #192133;
      padding:10px 12px;border-radius:12px}
    textarea:focus,select:focus,input:focus{border-color:var(--accent)}
    .range-wrap{background:#0a0f1b;border:1px solid #192133;padding:12px;border-radius:12px}
    input[type=range]{width:100%}
    .row{display:flex;flex-wrap:wrap;gap:12px}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:12px;background:var(--chip);
      border:1px solid #1f2937;font-size:14px}
    .btns{display:flex;gap:10px;flex-wrap:wrap}
    .btn{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:14px;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid #334155;color:var(--text)}
    .results{display:grid;gap:12px}
    .result{border:1px solid #1f2937;border-left:4px solid var(--accent);padding:12px;border-radius:12px;background:#0a0f1b}
    .danger{border-left-color:var(--danger)}
    .success{border-left-color:var(--accent-2)}
    footer{margin-top:16px;color:#94a3b8;font-size:12px}
  </style>
</head>
<body>
<div class="container">
  <h1>GTA-RP Trauma Triage</h1>
  <div class="grid">
    <section class="card">
      <label>R√©sum√© de l'incident</label>
      <textarea id="incident" rows="3" placeholder="Ex. chute de moto..."></textarea>

      <label>Zone principale</label>
      <select id="location">
        <option value="head">T√™te / Cr√¢ne</option><option value="neck">Cou</option>
        <option value="chest">Thorax</option><option value="abdomen">Abdomen</option>
        <option value="pelvis">Bassin</option><option value="upper_ext">Membres sup√©rieurs</option>
        <option value="lower_ext">Membres inf√©rieurs</option><option value="back">Dos</option>
        <option value="skin">Peau / Plaies</option>
      </select>

      <label>Douleur (1‚Äì10)</label>
      <div class="range-wrap">
        <input id="pain" type="range" min="1" max="10" value="5" step="1" />
        <div id="pain-label" style="margin-top:6px;font-weight:600;">S√©v√©rit√©: 5 ‚Äî Mod√©r√©e</div>
      </div>

      <div class="row" style="margin-top:10px">
        <div><label>√Çge</label><input id="age" type="text" placeholder="ex. 30" /></div>
        <div><label>D√©lai (h)</label><input id="delay" type="text" placeholder="ex. 2" /></div>
      </div>
      <label>ATCD</label>
      <div class="row">
        <label class="chip"><input type="checkbox" id="hx-anticoag" /> Anticoagulants/AA</label>
        <label class="chip"><input type="checkbox" id="hx-diabetes" /> Diab√®te</label>
        <label class="chip"><input type="checkbox" id="hx-immuno" /> Immunod√©pression</label>
      </div>
      <label>Signes visibles</label>
      <div class="row">
        <label class="chip"><input type="checkbox" id="f-bleeding" /> Saignement</label>
        <label class="chip"><input type="checkbox" id="f-deformity" /> D√©formation</label>
        <label class="chip"><input type="checkbox" id="f-loc" /> Perte conscience</label>
      </div>

      <div class="btns" style="margin-top:14px">
        <button class="btn" id="btn-calc">Calculer</button>
        <button class="btn secondary" id="btn-reset">R√©initialiser</button>
      </div>
    </section>

    <section class="card">
      <div id="results" class="results"></div>
      <button class="btn" id="btn-copy" style="margin-top:10px;width:100%">üìã Copier le r√©sum√©</button>
    </section>
  </div>
  <footer>v0.3 ‚Äî Utilisation RP uniquement</footer>
</div>

<script>
const els={
 incident:document.getElementById('incident'),location:document.getElementById('location'),
 pain:document.getElementById('pain'),painLabel:document.getElementById('pain-label'),
 age:document.getElementById('age'),delay:document.getElementById('delay'),
 hxAnticoag:document.getElementById('hx-anticoag'),hxDiabetes:document.getElementById('hx-diabetes'),
 hxImmuno:document.getElementById('hx-immuno'),
 fBleeding:document.getElementById('f-bleeding'),fDeformity:document.getElementById('f-deformity'),fLoc:document.getElementById('f-loc'),
 btnCalc:document.getElementById('btn-calc'),btnReset:document.getElementById('btn-reset'),
 results:document.getElementById('results'),btnCopy:document.getElementById('btn-copy')
};
function updatePainLabel(){
 const v=Number(els.pain.value);
 const band=v<=3?'Faible':v<=7?'Mod√©r√©e':'S√©v√®re';
 els.painLabel.textContent=`S√©v√©rit√©: ${v} ‚Äî ${band}`;
}
els.pain.addEventListener('input',updatePainLabel);updatePainLabel();

function compute(ctx){
 const {location,pain,findings,age,delayHours,hx}=ctx;const out=[];const p=Number(pain);
 if(findings.bleeding) out.push({tag:'H√©morragie',prio:1,ad:'Comprimer, √©vacuation.'});
 if(findings.lossOfConsciousness) out.push({tag:'TCC suspect',prio:1,ad:'Immobiliser t√™te/cou, √©vacuation.'});
 if(location==='head'||location==='neck'){
   if(p>=8) out.push({tag:'TC mod√©r√©/s√©v√®re',prio:2,ad:'√âvacuer.'});
   else if(p>=4) out.push({tag:'Commotion',prio:3,ad:'Repos, glace.'});
   else out.push({tag:'Contusion l√©g√®re',prio:4,ad:'Surveillance.'});
 }
 if(location==='upper_ext'||location==='lower_ext'){
   if(findings.deformity||p>=8) out.push({tag:'Fracture possible',prio:2,ad:'Attelle, √©vacuation.'});
   else if(p>=5) out.push({tag:'Entorse/contusion s√©v√®re',prio:3,ad:'RICE.'});
   else out.push({tag:'Contusion',prio:4,ad:'Surveillance.'});
 }
 if(!out.length) out.push({tag:'√âvaluation non sp√©cifique',prio:4,ad:'R√©√©valuer.'});
 const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));
 const extremeAge=Number.isFinite(age)&&(age<18||age>65);
 const anticoag=hx&&hx.anticoagulants;
 const persist=(delayHours>=24)&&p>=6;
 for(const i of out){
   let pr=i.prio;
   if(anticoag&&(location==='head'||findings.lossOfConsciousness))pr=1;
   if(extremeAge&&pr>1)pr-=1;
   if(persist&&pr>1)pr-=1;
   i.prio=clamp(pr,1,4);
 }
 out.sort((a,b)=>a.prio-b.prio);
 return out;
}

function getVals(){
 const age=parseInt(els.age.value,10),delay=parseInt(els.delay.value,10);
 return{
  incident:els.incident.value.trim(),location:els.location.value,pain:Number(els.pain.value),
  age:Number.isFinite(age)?age:undefined,delayHours:Number.isFinite(delay)?delay:0,
  hx:{anticoagulants:els.hxAnticoag.checked,diabetes:els.hxDiabetes.checked,immuno:els.hxImmuno.checked},
  findings:{bleeding:els.fBleeding.checked,deformity:els.fDeformity.checked,lossOfConsciousness:els.fLoc.checked}
 };
}

function calc(){
 const vals=getVals();const list=compute(vals);
 els.results.innerHTML=list.map(i=>`<div class="result ${i.prio===1?'danger':i.prio===2?'success':''}">
  <strong>${i.tag}</strong><div>${i.ad}</div><div>Priorit√© ${i.prio}</div></div>`).join('');
}
function reset(){
 document.querySelectorAll('input,textarea,select').forEach(e=>{if(e.type==='checkbox')e.checked=false;else e.value=''});
 els.results.innerHTML='';
}
function copyResume(){
 const v=getVals();
 let txt=`R√©sum√© RP ‚Äî Trauma triage\\nIncident: ${v.incident||'‚Äî'}\\nZone: ${v.location}\\nDouleur: ${v.pain}/10`;
 if(v.age)txt+=`\\n√Çge: ${v.age}`;if(v.delayHours)txt+=`\\nD√©lai: ${v.delayHours}h`;
 const atcd=[];if(v.hx.anticoagulants)atcd.push('anticoagulants');if(v.hx.diabetes)atcd.push('diab√®te');if(v.hx.immuno)atcd.push('immunod√©pression');
 if(atcd.length)txt+=`\\nATCD: ${atcd.join(', ')}`;
 const results=els.results.querySelectorAll('.result');
 if(results.length){txt+='\\nR√©sultats:';results.forEach(r=>{txt+=`\\n - ${r.querySelector('strong').textContent} (P${r.querySelector('div:last-child').textContent.replace(/[^0-9]/g,'')})`;});}
 navigator.clipboard.writeText(txt).then(()=>alert('R√©sum√© copi√© !'));
}
els.btnCalc.addEventListener('click',calc);
els.btnReset.addEventListener('click',reset);
els.btnCopy.addEventListener('click',copyResume);
</script>
</body>
</html>
