<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GTA-RP Trauma Triage ‚Äî Pr√©-diagnostic</title>
  <style>
    :root {
      --bg: #0f172a; /* slate-900 */
      --card: #0b1220; /* darker */
      --text: #e2e8f0; /* slate-200 */
      --muted: #94a3b8; /* slate-400 */
      --accent: #6366f1; /* indigo-500 */
      --accent-2: #22c55e; /* green-500 */
      --warn: #f59e0b; /* amber-500 */
      --danger: #ef4444; /* red-500 */
      --border: #1f2937; /* gray-800 */
      --chip: #111827; /* gray-900 */
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% -10%, #1e293b 0, #0b1020 60%, #060913 100%);
      color: var(--text);
    }
    .container { max-width: 980px; margin: 40px auto; padding: 0 16px; }
    header { display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:20px; }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo { width:40px; height:40px; border-radius:12px; background: linear-gradient(135deg, var(--accent), #8b5cf6); box-shadow: 0 10px 25px rgba(99,102,241,.35); }
    h1 { font-size: clamp(22px, 3vw, 28px); margin:0; letter-spacing: .2px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.015)); border:1px solid var(--border); border-radius: 18px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    .grid { display:grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 900px) { 
    .grid { grid-template-columns: 1.1fr .9fr; } }
    label { font-size: 14px; color: var(--muted); display:block; margin-bottom:6px; }
    textarea, select, input[type="text"] { width:100%; background:#0a0f1b; color:var(--text); border:1px solid #192133; padding:10px 12px; border-radius:12px; outline:none; }
    textarea:focus, select:focus, input[type="text"]:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(99,102,241,.25); }
    .range-wrap { background:#0a0f1b; border:1px solid #192133; padding:12px; border-radius:12px; }
    input[type="range"] { width:100%; }
    .row { display:flex; flex-wrap:wrap; gap:12px; }
    .chip { display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:12px; background: var(--chip); border:1px solid #1f2937; font-size: 14px; }
    .btns { display:flex; gap:10px; flex-wrap:wrap; }
    .btn { background:#6366f126; color:white; border: 1px solid #6366f1; padding:10px 14px; border-radius:14px; cursor:pointer; font-weight:600; letter-spacing:.2px; }
    .btn.secondary { background:transparent; border:1px solid #334155; color: var(--text); }
    .btn.ghost { background:transparent; color: var(--muted); }
    .section-title { font-size:18px; font-weight:700; margin: 6px 0 10px; }
    .results { display:grid; gap:12px; }
    .result { border:1px solid #1f2937; border-left:4px solid var(--accent); padding:12px; border-radius:12px; background:#0a0f1b; }
    .prio { font-size:12px; color:#cbd5e1; opacity:.9; }
    .tag { font-weight:700; }
    .advice { color:#cbd5e1; margin-top:4px; }
    .callout { background: rgba(245, 158, 11, .1); border:1px solid rgba(245, 158, 11, .35); color:#fde68a; border-radius:12px; padding:10px 12px; font-size:14px; }
    footer { margin-top: 16px; color: #94a3b8; font-size: 12px; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; background:#0b1220; border:1px solid #1f2937; padding:2px 6px; border-radius:6px; }
    .titlebar { display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:12px; }
    .pill { font-size:12px; padding:6px 10px; border:1px solid #334155; border-radius:999px; color:#a5b4fc; background: rgba(99,102,241,.08); }
    .success { border-left-color: var(--accent-2); }
    .danger { border-left-color: var(--danger); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Trauma Triage ‚Äî Outil de <strong>pr√©</strong>-diagnostic</h1>
          <div class="pill" aria-live="polite">Diagnostique d'intervention rapide¬∑ Ne remplace pas un avis m√©dical pouss√© √† l'hopital</div>
        </div>
      </div>
      <div class="row">
        <button class="btn ghost" id="btn-export-json" title="Exporter le cas (JSON)">Exporter</button>
        <button class="btn ghost" id="btn-print" title="Imprimer / PDF">Imprimer</button>
      </div>
    </header>

    <div class="grid">
      <!-- Formulaire -->
      <section class="card" aria-labelledby="form-title">
        <div class="titlebar">
          <div class="section-title" id="form-title">Entr√©e patient RP</div>
          <div class="prio">Remplissez les champs puis cliquez <span class="kbd">Calculer</span></div>
        </div>

        <div class="row" style="gap:16px">
          <div style="flex:1 1 100%">
            <label for="incident">Que s'est-il pass√© ? (r√©sum√© court)</label>
            <textarea id="incident" rows="3" placeholder="Ex.: chute de moto √† 80 km/h, impact t√™te/√©paule, casque port√©"></textarea>
          </div>

          <div style="flex:1 1 220px; min-width: 220px;">
            <label for="location">Localisation principale de la douleur</label>
            <select id="location">
              <option value="head">T√™te / Cr√¢ne</option>
              <option value="neck">Cou / Gorge</option>
              <option value="chest">Thorax / Poitrine</option>
              <option value="abdomen">Abdomen / Ventre</option>
              <option value="pelvis">Bassin</option>
              <option value="upper_ext">Membres sup√©rieurs</option>
              <option value="lower_ext">Membres inf√©rieurs</option>
              <option value="back">Dos</option>
              <option value="skin">Peau / Plaies</option>
            </select>
          </div>

          <div style="flex:1 1 260px; min-width: 260px;">
            <label for="pain">Niveau de douleur (1‚Äì10)</label>
            <div class="range-wrap">
              <input id="pain" type="range" min="1" max="10" value="5" step="1" />
              <div style="display:flex; justify-content:space-between; margin-top:6px; font-size:12px; color:var(--muted)">
                <span>1</span><span>5</span><span>10</span>
              </div>
              <div id="pain-label" style="margin-top:6px; font-weight:600;">S√©v√©rit√©: 5 ‚Äî Mod√©r√©e</div>
            </div>
          </div>
        </div>

        <!-- Champs compl√©mentaires -->
        <div class="row" style="margin-top:10px; gap:12px">
          <div style="flex:1 1 160px; min-width:160px;">
            <label for="age">√Çge</label>
            <input type="text" id="age" placeholder="ex. 28" />
          </div>
          <div style="flex:1 1 200px; min-width:200px;">
            <label for="delay">D√©lai depuis l'incident (heures)</label>
            <input type="text" id="delay" placeholder="ex. 3" />
          </div>
          <div style="flex:2 1 260px; min-width:260px;">
            <label>ATCD (cocher si pr√©sents)</label>
            <div class="row">
              <label class="chip"><input type="checkbox" id="hx-anticoag" /> Anticoagulants/AA</label>
              <label class="chip"><input type="checkbox" id="hx-diabetes" /> Diab√®te</label>
              <label class="chip"><input type="checkbox" id="hx-immuno" /> Immunod√©pression</label>
            </div>
          </div>
        </div>

        <div style="margin-top:10px">
          <label>Signes visibles (cocher si pr√©sents)</label>
          <div class="row">
            <label class="chip"><input type="checkbox" id="f-bleeding" /> Saignement important</label>
            <label class="chip"><input type="checkbox" id="f-deformity" /> D√©formation</label>
            <label class="chip"><input type="checkbox" id="f-loc" /> Perte de conscience / confusion</label>
          </div>
        </div>

        <div class="btns" style="margin-top:14px">
          <button class="btn" id="btn-calc">Calculer</button>
          <button class="btn secondary" id="btn-reset" type="button">R√©initialiser</button>
        </div>
      </section>

      <!-- R√©sultats -->
      <section class="card" aria-labelledby="res-title">
        <div class="titlebar">
          <div class="section-title" id="res-title">R√©sultats (pr√©-diagnostic)</div>
          <div class="prio" id="meta-count">‚Äî</div>
        </div>
        <div id="results" class="results" aria-live="polite"></div>
        <div id="no-results" class="callout" style="display:none; margin-top:8px">Aucun r√©sultat. Saisissez des informations puis cliquez <span class="kbd">Calculer</span>.</div>

        <!-- Bouton copier -->
        <button class="btn" id="btn-copy" style="margin-top:10px; width:100%; backgroud: #6366f13b ; border:1px solid #6366f1">üìã Copier le r√©sum√©</button>
      </section>
    </div>

    <footer>
      <p>¬© <span id="year"></span> ‚Äî Trauma Triage.</p>
    </footer>
  </div>

  <script>
    const els = {
      incident: document.getElementById('incident'),
      location: document.getElementById('location'),
      pain: document.getElementById('pain'),
      painLabel: document.getElementById('pain-label'),
      age: document.getElementById('age'),
      delay: document.getElementById('delay'),
      hxAnticoag: document.getElementById('hx-anticoag'),
      hxDiabetes: document.getElementById('hx-diabetes'),
      hxImmuno: document.getElementById('hx-immuno'),
      fBleeding: document.getElementById('f-bleeding'),
      fDeformity: document.getElementById('f-deformity'),
      fLoc: document.getElementById('f-loc'),
      btnCalc: document.getElementById('btn-calc'),
      btnReset: document.getElementById('btn-reset'),
      btnExport: document.getElementById('btn-export-json'),
      btnPrint: document.getElementById('btn-print'),
      btnCopy: document.getElementById('btn-copy'),
      results: document.getElementById('results'),
      noResults: document.getElementById('no-results'),
      metaCount: document.getElementById('meta-count'),
    };

    function updatePainLabel() {
      const v = Number(els.pain.value);
      const band = v <= 3 ? 'Faible' : v <= 7 ? 'Mod√©r√©e' : 'S√©v√®re';
      els.painLabel.textContent = `S√©v√©rit√©: ${v} ‚Äî ${band}`;
    }
    els.pain.addEventListener('input', updatePainLabel);
    updatePainLabel();

    // ************ MOTEUR √âTENDU D'HYPOTH√àSES (pr√©sentation inchang√©e) ************
    function computePreDiagnosis({ location, pain, findings, age, delayHours, hx }) {
      const out = [];
      const p = Number(pain);
      const extremeAge = Number.isFinite(age) && (age < 18 || age > 65);
      const anticoag = !!(hx && hx.anticoagulants);
      const persist = (delayHours >= 24) && (p >= 6);

      // Red flags transversaux
      if (findings.bleeding) out.push({ tag: 'H√©morragie active', priority: 1, advice: 'Compression/garrot (RP si anatomie adapt√©e), √©vacuation rapide.' });
      if (findings.lossOfConsciousness) out.push({ tag: 'Alt√©ration neurologique (TCC suspect)', priority: 1, advice: 'Surveillance neuro, immobilisation t√™te/cou si m√©canisme violent, √©vacuation.' });

      // ===== T√äTE / COU =====
      if (location === 'head' || location === 'neck') {
        if (p >= 8) {
          out.push({ tag: 'Traumatisme cr√¢nien mod√©r√©/s√©v√®re', priority: 2, advice: 'C√©phal√©es intenses, vomissements, troubles ‚Üí √©vacuer.' });
          if (anticoag || extremeAge) out.push({ tag: 'H√©morragie intracr√¢nienne suspecte', priority: 1, advice: 'Facteur de risque (√¢ge/anticoagulants). √âvacuation.' });
        } else if (p >= 4) {
          out.push({ tag: 'Commotion c√©r√©brale', priority: 3, advice: 'Repos, glace, surveillance 24h RP.' });
        } else {
          out.push({ tag: 'Contusion du scalp', priority: 4, advice: 'Glace locale, r√©√©valuation.' });
        }
        // Cou
        if (location === 'neck') {
          if (p >= 6 || findings.deformity) {
            out.push({ tag: 'Atteinte cervicale (entorse/l√©sion ligamentaire)', priority: 2, advice: 'Collier (RP), √©viter mobilisations, √©vacuation si signes neuro.' });
          } else {
            out.push({ tag: 'Contracture cervicale (coup du lapin)', priority: 3, advice: 'Repos, chaleur douce, antalgiques RP.' });
          }
        }
        // Plaie possible au visage/cuir chevelu
        if (findings.bleeding && p <= 7) {
          out.push({ tag: 'Plaie du scalp/visage', priority: 2, advice: 'Nettoyage (RP), compression, √©valuation suture (RP).' });
        }
      }

      // ===== THORAX =====
      if (location === 'chest') {
        if (p >= 8 || findings.deformity) {
          out.push({ tag: 'Fracture costale multiple / volet thoracique', priority: 1, advice: 'Douleur + instabilit√©, d√©tresse respi possible ‚Üí √©vacuation urgente.' });
          out.push({ tag: 'Pneumothorax/contusion pulmonaire (suspect)', priority: 1, advice: 'Dyspn√©e, douleur lat√©rale, aggravation √† l‚Äôeffort ‚Üí √©vacuation.' });
        } else if (p >= 5) {
          out.push({ tag: 'Fracture costale isol√©e', priority: 2, advice: 'Analg√©sie RP, surveillance dyspn√©e/toux.' });
          out.push({ tag: 'Contusion costale', priority: 3, advice: 'Repos, glace, respiration contr√¥l√©e.' });
        } else {
          out.push({ tag: 'Douleur pari√©tale mineure', priority: 4, advice: 'Repos, surveillance domiciliaire RP.' });
        }
        out.push({ tag: 'Contusion sternale', priority: (p >= 6 ? 2 : 3), advice: 'Douleur ant√©rieure centrale, √©pargner efforts.' });
        if (persist) out.push({ tag: 'Contusion cardiaque (RP, si choc ant√©rieur)', priority: 2, advice: 'Douleur persistante >24h ‚Üí √©vacuation.' });
      }

      // ===== ABDOMEN / BASSIN =====
      if (location === 'abdomen' || location === 'pelvis') {
        if (p >= 7 || findings.bleeding) {
          out.push({ tag: 'L√©sion visc√©rale / h√©morragie interne (suspecte)', priority: 1, advice: 'Douleur diffuse, signes de choc ‚Üí transport rapide.' });
        } else if (p >= 4) {
          out.push({ tag: 'Contusion abdominale', priority: 2, advice: 'Surveillance d√©fense/rigidit√©, aggravation ‚Üí √©vacuation.' });
        } else {
          out.push({ tag: 'Atteinte pari√©tale mineure', priority: 4, advice: 'Glace, repos, r√©√©valuation.' });
        }
        if (location === 'pelvis' && (p >= 6 || findings.deformity)) {
          out.push({ tag: 'Atteinte pelvienne (suspecte)', priority: 1, advice: 'Douleur bassin, instabilit√© ‚Üí √©vacuation.' });
        }
        if (persist) out.push({ tag: 'H√©matome pari√©tal √©volutif', priority: 2, advice: 'Douleur ‚â•6 persistante >24h.' });
      }

      // ===== MEMBRES SUP√âRIEURS / INF√âRIEURS =====
      if (location === 'upper_ext' || location === 'lower_ext') {
        if (findings.deformity || p >= 8) {
          out.push({ tag: 'Fracture d√©plac√©e (suspecte)', priority: 2, advice: 'D√©formation, douleur vive ‚Üí attelle, √©vacuation.' });
          out.push({ tag: 'Luxation (√©paule/coude/cheville/doigts)', priority: 2, advice: 'D√©formation + impotence ‚Üí immobiliser, √©vacuation.' });
        } else if (p >= 5) {
          out.push({ tag: 'Entorse s√©v√®re (grade II/III)', priority: 3, advice: '≈íd√®me, instabilit√© ‚Üí RICE, immobilisation RP.' });
          out.push({ tag: 'Fracture non d√©plac√©e (suspecte)', priority: 3, advice: 'Douleur localis√©e √† la palpation osseuse.' });
        } else {
          out.push({ tag: 'Contusion musculaire', priority: 4, advice: 'Repos, glace, √©l√©vation.' });
          out.push({ tag: 'Entorse l√©g√®re (grade I)', priority: 4, advice: 'Contention souple RP, reprise progressive.' });
        }
        // Ajouts diff√©rentiels
        out.push({ tag: 'Tendinopathie/√©longation', priority: (p >= 5 ? 3 : 4), advice: 'Douleur √† l‚Äôeffort/√©tirement.' });
        if (findings.bleeding) out.push({ tag: 'Plaie des tissus mous', priority: 2, advice: 'Nettoyage, compression, √©valuation suture (RP).' });
        if (persist) out.push({ tag: 'Syndrome douloureux persistant', priority: 3, advice: 'Douleur ‚â•6 >24h ‚Üí r√©√©valuation/√©vacuation RP.' });
      }

      // ===== DOS =====
      if (location === 'back') {
        if (p >= 7 || findings.deformity || findings.lossOfConsciousness) {
          out.push({ tag: 'Atteinte rachidienne (suspecte)', priority: 1, advice: 'Immobiliser, √©viter rotations, √©vacuation.' });
        } else {
          out.push({ tag: 'Lombalgie/contusion dorsale', priority: 3, advice: 'Repos, chaleur douce, antalgiques RP.' });
        }
        if (extremeAge && p >= 6) {
          out.push({ tag: 'Fracture tassement vert√©bral (suspecte)', priority: 2, advice: 'Douleur aigu√´ chez sujet √¢g√© ‚Üí √©vacuation.' });
        }
        out.push({ tag: 'Contracture/paravertebral spasm', priority: 4, advice: '√âtirements doux, repos court.' });
      }

      // ===== PEAU =====
      if (location === 'skin') {
        if (p >= 6 || findings.bleeding) {
          out.push({ tag: 'Lac√©ration / avulsion', priority: 2, advice: 'Nettoyage, compresser, suture (RP) selon taille.' });
        } else {
          out.push({ tag: 'Abrasions/√©raflures', priority: 4, advice: 'Nettoyage doux, pansement.' });
        }
        out.push({ tag: 'Contusion cutan√©e / h√©matome', priority: (p >= 5 ? 3 : 4), advice: 'Glace, compression l√©g√®re.' });
      }

      // Fallback minimal
      if (!out.length) out.push({ tag: '√âvaluation non sp√©cifique', priority: 4, advice: 'Surveillance, √©viter activit√©, r√©√©valuation.' });

      // ===== Modificateurs g√©n√©raux (ne change PAS l‚ÄôUI) =====
      const clamp = (n, min, max) => Math.max(min, Math.min(max, n));
      for (const item of out) {
        let pr = item.priority;
        if (anticoag && (location === 'head' || location === 'neck' || findings.lossOfConsciousness)) pr = 1;
        if (extremeAge && pr > 1) pr -= 1;
        if (persist && pr > 1) pr -= 1;
        item.priority = clamp(pr, 1, 4);
      }

      // Tri final
      out.sort((a, b) => a.priority - b.priority);
      return out;
    }
    // ************ FIN MOTEUR √âTENDU ************

    function renderResults(list) {
      els.results.innerHTML = '';
      if (!list || !list.length) {
        els.noResults.style.display = 'block';
        els.metaCount.textContent = '‚Äî';
        return;
      }
      els.noResults.style.display = 'none';
      els.metaCount.textContent = `${list.length} hypoth√®se(s)`;
      for (const item of list) {
        const div = document.createElement('div');
        div.className = 'result ' + (item.priority === 1 ? 'danger' : item.priority === 2 ? 'success' : '');
        div.innerHTML = `
          <div class="tag">${item.tag}</div>
          <div class="advice">${item.advice}</div>
          <div class="prio">Priorit√©: ${item.priority}</div>
        `;
        els.results.appendChild(div);
      }
    }

    function getFormValues() {
      const age = parseInt(els.age.value, 10);
      const delayHours = parseInt(els.delay.value, 10);
      return {
        incident: els.incident.value.trim(),
        location: els.location.value,
        pain: Number(els.pain.value),
        age: Number.isFinite(age) ? age : undefined,
        delayHours: Number.isFinite(delayHours) ? delayHours : 0,
        hx: {
          anticoagulants: !!els.hxAnticoag.checked,
          diabetes: !!els.hxDiabetes.checked,
          immunodepression: !!els.hxImmuno.checked,
        },
        findings: {
          bleeding: els.fBleeding.checked,
          deformity: els.fDeformity.checked,
          lossOfConsciousness: els.fLoc.checked,
        }
      };
    }

    function calculate(e) {
      e && e.preventDefault();
      const payload = getFormValues();
      const res = computePreDiagnosis(payload);
      renderResults(res);
    }

    function resetForm() {
      els.incident.value = '';
      els.location.value = 'head';
      els.pain.value = 5; updatePainLabel();
      els.age.value = '';
      els.delay.value = '';
      els.hxAnticoag.checked = false;
      els.hxDiabetes.checked = false;
      els.hxImmuno.checked = false;
      els.fBleeding.checked = false;
      els.fDeformity.checked = false;
      els.fLoc.checked = false;
      els.results.innerHTML = '';
      els.noResults.style.display = 'block';
      els.metaCount.textContent = '‚Äî';
    }

    function exportJSON() {
      const data = {
        ...getFormValues(),
        results: Array.from(els.results.querySelectorAll('.result')).map(div => ({
          tag: div.querySelector('.tag')?.textContent || '',
          priority: Number((div.querySelector('.prio')?.textContent || '').replace(/[^0-9]/g,'')),
        })),
        timestamp: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `triage_case_${Date.now()}.json`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    function copySummary() {
      const v = getFormValues();
      const resCards = els.results.querySelectorAll('.result');
      let txt = `R√©sum√© RP ‚Äî Trauma Triage\n`;
      txt += `Incident: ${v.incident || '‚Äî'}\n`;
      txt += `Zone: ${v.location}\nDouleur: ${v.pain}/10\n`;
      if (v.age !== undefined) txt += `√Çge: ${v.age}\n`;
      if (v.delayHours) txt += `D√©lai: ${v.delayHours}h\n`;
      const atcd = [];
      if (v.hx.anticoagulants) atcd.push('anticoagulants/AA');
      if (v.hx.diabetes) atcd.push('diab√®te');
      if (v.hx.immunodepression) atcd.push('immunod√©pression');
      if (atcd.length) txt += `ATCD: ${atcd.join(', ')}\n`;
      if (resCards.length) {
        txt += `R√©sultats:\n`;
        resCards.forEach(card => {
          const t = card.querySelector('.tag')?.textContent || '';
          const p = card.querySelector('.prio')?.textContent.replace(/[^0-9]/g,'') || '';
          const a = card.querySelector('.advice')?.textContent || '';
          txt += ` - ${t} (P${p}) ‚Äî ${a}\n`;
        });
      } else {
        txt += `R√©sultats: ‚Äî\n`;
      }
      navigator.clipboard.writeText(txt).then(() => {
        const old = els.btnCopy.textContent;
        els.btnCopy.textContent = '‚úî R√©sum√© copi√©';
        setTimeout(() => els.btnCopy.textContent = old, 1200);
      });
    }

    document.getElementById('year').textContent = new Date().getFullYear();
    els.btnCalc.addEventListener('click', calculate);
    els.btnReset.addEventListener('click', resetForm);
    els.btnExport.addEventListener('click', exportJSON);
    els.btnPrint.addEventListener('click', () => window.print());
    els.btnCopy.addEventListener('click', copySummary);

    // Initial state
    resetForm();
  </script>
</body>
</html>



