<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Triage blessures — prototype</title>
  <style>
    :root{
      --bg:#0f172a;/* slate-900 */
      --panel:#111827ee; /* gray-900 */
      --card:#111827; /* gray-900 */
      --muted:#94a3b8;/* slate-400 */
      --text:#e5e7eb;/* gray-200 */
      --accent:#22c55e;/* green-500 */
      --warn:#f59e0b;/* amber-500 */
      --danger:#ef4444;/* red-500 */
      --info:#3b82f6;/* blue-500 */
      --border:#1f2937;/* gray-800 */
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 10% -10%,#1f2937,transparent),radial-gradient(1200px 600px at 110% -10%,#0b1020,transparent),var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;}
    .container{max-width:980px;margin:32px auto;padding:0 16px}
    header{display:flex;gap:12px;align-items:center;margin-bottom:20px}
    header h1{font-size: clamp(22px, 4vw, 32px);margin:0}
    header .beta{font-size:12px;color:var(--muted);padding:4px 8px;border:1px solid var(--border);border-radius:999px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.1fr 0.9fr}}
    .card{background:linear-gradient(180deg,rgba(17,24,39,0.9),rgba(17,24,39,0.7));border:1px solid var(--border);border-radius:16px;padding:18px;backdrop-filter: blur(6px);}
    .card h2{margin:0 0 12px 0;font-size:18px}
    label{display:block;margin:10px 0 6px;font-weight:600}
    select, input[type="text"], textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#0b1220;color:var(--text)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .tags{display:flex;flex-wrap:wrap;gap:10px}
    .tag{display:inline-flex;gap:8px;align-items:center;border:1px solid var(--border);background:#0b1220;padding:8px 10px;border-radius:12px}
    .actions{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
    button{appearance:none;border:none;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer}
    .primary{background:var(--info);color:white}
    .secondary{background:#0b1220;color:var(--text);border:1px solid var(--border)}
    .meter{height:12px;border-radius:999px;background:#0b1220;border:1px solid var(--border);overflow:hidden}
    .bar{height:100%;width:0%}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid var(--border);color:var(--muted);font-size:12px}
    .result{font-size:15px;line-height:1.5}
    .muted{color:var(--muted)}
    .kicker{font-size:12px;color:var(--muted);margin:0}
    .list{margin:8px 0 0 18px}
    footer{margin:24px 0;color:var(--muted);font-size:12px}
    .danger{color:var(--danger)}
    .warn{color:var(--warn)}
    .ok{color:var(--accent)}
    .panel{border:1px dashed var(--border);border-radius:12px;padding:10px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Triage de blessures (prototype)</h1>
      <span class="beta">Ne remplace pas un avis médical</span>
    </header>

    <div class="grid">
      <div class="card">
        <h2>Décrivez la situation</h2>
        <p class="kicker">Cet outil <strong>oriente</strong> et ne pose pas de diagnostic. En cas de doute, appelez le 15 (ou 112).</p>
        
        <label for="location">Zone concernée</label>
        <select id="location">
          <option value="">— Choisir —</option>
          <option value="tete">Tête / visage</option>
          <option value="cou">Cou / nuque</option>
          <option value="epaule_bras">Épaule / bras</option>
          <option value="poignet_main">Poignet / main / doigts</option>
          <option value="dos">Dos</option>
          <option value="hanche_cuisse">Hanche / cuisse</option>
          <option value="genou">Genou</option>
          <option value="cheville_pied">Cheville / pied</option>
          <option value="thorax">Thorax</option>
          <option value="abdomen">Abdomen</option>
          <option value="peau">Peau (coupure / brûlure)</option>
        </select>

        <label>Circonstances (sélection multiple)</label>
        <div class="tags">
          <label class="tag"><input type="checkbox" value="chute"/> Chute</label>
          <label class="tag"><input type="checkbox" value="torsion"/> Torsion / faux pas</label>
          <label class="tag"><input type="checkbox" value="coup_direct"/> Coup direct</label>
          <label class="tag"><input type="checkbox" value="surmenage"/> Surmenage / effort répété</label>
          <label class="tag"><input type="checkbox" value="sport"/> Pendant le sport</label>
          <label class="tag"><input type="checkbox" value="route"/> Accident de la route</label>
          <label class="tag"><input type="checkbox" value="objet_tranchant"/> Objet tranchant</label>
          <label class="tag"><input type="checkbox" value="brulure"/> Brûlure / chaleur</label>
        </div>

        <!-- Champs complémentaires -->
        <div class="row">
          <div>
            <label for="age">Âge (RP)</label>
            <input type="text" id="age" placeholder="ex. 28"/>
          </div>
          <div>
            <label for="delay">Délai depuis l'incident (heures)</label>
            <input type="text" id="delay" placeholder="ex. 3"/>
          </div>
        </div>
        <label>ATCD (cocher si présents)</label>
        <div class="tags">
          <label class="tag"><input type="checkbox" id="hx-anticoag"/> Anticoagulants/AA</label>
          <label class="tag"><input type="checkbox" id="hx-diabetes"/> Diabète</label>
          <label class="tag"><input type="checkbox" id="hx-immuno"/> Immunodépression</label>
        </div>

        <div class="row">
          <div>
            <label for="pain">Douleur (1–10)</label>
            <input id="pain" type="range" min="1" max="10" step="1" value="3"/>
            <div style="display:flex;align-items:center;gap:8px;margin-top:6px">
              <span class="pill">Niveau : <strong id="painVal">3</strong> / 10</span>
              <div class="meter" style="flex:1"><div id="bar" class="bar"></div></div>
            </div>
          </div>
          <div>
            <label>Signes d'alerte (urgents)</label>
            <div class="panel">
              <label><input type="checkbox" class="flag" value="saignement"/> Saignement abondant</label><br/>
              <label><input type="checkbox" class="flag" value="deformation"/> Déformation évidente / os apparent</label><br/>
              <label><input type="checkbox" class="flag" value="appui"/> Impossible de marcher / s'appuyer</label><br/>
              <label><input type="checkbox" class="flag" value="conscience"/> Perte de connaissance / confusion</label><br/>
              <label><input type="checkbox" class="flag" value="respir"/> Difficulté à respirer / douleur thoracique</label><br/>
              <label><input type="checkbox" class="flag" value="engourdissement"/> Paralysie / engourdissement étendu</label>
            </div>
          </div>
        </div>

        <div class="actions">
          <button class="primary" id="eval">Évaluer</button>
          <button class="secondary" id="reset">Réinitialiser</button>
        </div>
      </div>

      <div class="card">
        <h2>Résultat</h2>
        <div id="result" class="result muted">Renseignez les champs à gauche puis cliquez sur « Évaluer ».</div>
      </div>
    </div>

    <footer>
      <p>⚠️ Cet outil est expérimental. Il ne remplace pas un professionnel de santé. En France, composez le <strong>15</strong> (SAMU) ou le <strong>112</strong> en cas d'urgence.</p>
    </footer>
  </div>

<script>
  const pain = document.getElementById('pain');
  const painVal = document.getElementById('painVal');
  const bar = document.getElementById('bar');
  function updateMeter(){
    const v = Number(pain.value);
    painVal.textContent = v;
    const pct = (v/10)*100;
    bar.style.width = pct + '%';
    bar.style.background = v>=8? 'var(--danger)' : v>=5? 'var(--warn)' : 'var(--accent)';
  }
  pain.addEventListener('input', updateMeter); updateMeter();

  const locationEl = document.getElementById('location');
  const result = document.getElementById('result');
  const ageEl = document.getElementById('age');
  const delayEl = document.getElementById('delay');
  const hxAnticoagEl = document.getElementById('hx-anticoag');
  const hxDiabEl = document.getElementById('hx-diabetes');
  const hxImmunoEl = document.getElementById('hx-immuno');

  const hypotheses = {
    'cheville_pied':{ torsion:'Entorse de cheville (ligaments)', chute:'Contusion / entorse', coup_direct:'Contusion / fracture possible' },
    'genou':{ torsion:'Entorse du genou (LLI/LCA) possible', chute:'Contusion / lésion méniscale', coup_direct:'Contusion / fracture possible' },
    'epaule_bras':{ chute:'Luxation / contusion', coup_direct:'Contusion / fracture possible', surmenage:'Tendinite (coiffe) possible' },
    'poignet_main':{ chute:'Fracture du poignet / entorse', objet_tranchant:'Plaie — soigner et vérifier', coup_direct:'Contusion' },
    'dos':{ surmenage:'Lombalgie mécanique', faux:'Lumbago' },
    'hanche_cuisse':{ chute:'Contusion / déchirure', surmenage:'Tendinite / élongation' },
    'tete':{ coup_direct:'Commotion possible', chute:'Commotion / plaie' },
    'cou':{ coup_direct:'Coup du lapin (entorse cervicale)', chute:'Entorse cervicale' },
    'thorax':{ coup_direct:'Contusion costale / fracture', respir:'Douleur thoracique — urgence si associée à gêne respiratoire' },
    'abdomen':{ coup_direct:'Contusion abdominale — surveiller', chute:'Traumatisme abdominal' },
    'peau':{ objet_tranchant:'Plaie cutanée', brulure:'Brûlure cutanée' }
  };

  function evaluate(){
    const zone = locationEl.value;
    const circ = Array.from(document.querySelectorAll('.tags input[type=checkbox]'))
                      .filter(i=>!i.id) // exclure ATCD tags
                      .filter(i=>i.checked).map(i=>i.value);
    const flags = Array.from(document.querySelectorAll('.flag:checked')).map(i=>i.value);
    const v = Number(pain.value);

    // nouveaux champs
    const age = parseInt(ageEl?.value||'',10);
    const delayH = parseInt(delayEl?.value||'',10) || 0;
    const hxAnticoag = !!(hxAnticoagEl && hxAnticoagEl.checked);
    const hxDiab = !!(hxDiabEl && hxDiabEl.checked);
    const hxImmuno = !!(hxImmunoEl && hxImmunoEl.checked);

    // 0) Règle spéciale: anticoagulants + tête/cou ou perte de connaissance => urgence
    if(hxAnticoag && (['tete','cou'].includes(zone) || flags.includes('conscience'))){
      result.innerHTML = `
        <p class="danger"><strong>Facteur de risque + traumatisme tête/cou :</strong> sous anticoagulants.</p>
        <p>Rendez-vous aux <strong>urgences</strong> pour évaluation.</p>
      `;
      return;
    }

    // 1) Red flags => emergencies
    if(flags.length>0){
      result.innerHTML = `
        <p class="danger"><strong>Urgence identifiée.</strong> Un ou plusieurs signes d'alerte sont cochés.</p>
        <p>Appelez le <strong>15</strong> (ou <strong>112</strong>) ou rendez-vous immédiatement aux urgences.</p>
        <ul class="list">${flags.map(f=>`<li>${labelFlag(f)}</li>`).join('')}</ul>
      `;
      return;
    }

    // 2) Règle douleur
    if(v >= 5){
      const hypo = guess(zone, circ);
      result.innerHTML = `
        <p class="warn"><strong>Douleur ${v}/10 :</strong> comme convenu, <strong>allez à l'hôpital</strong> pour des vérifications.</p>
        ${hypo? `<p>Hypothèses fréquentes selon vos réponses : <em>${hypo}</em>.</p>`:''}
        ${selfCare(zone)}
      `;
      return;
    }

    // 3) Scoring simple pour <5 + modificateurs
    let score = v; // base
    if(circ.includes('route')) score += 2;
    if(circ.includes('chute')) score += 1;
    if(['tete','cou','thorax','abdomen'].includes(zone)) score += 2;

    // Modificateurs heuristiques
    const extremeAge = Number.isFinite(age) && (age < 18 || age > 65);
    if(extremeAge) score += 1;
    if((delayH >= 24) && v >= 6) score += 1; // douleur persistante
    if(hxImmuno || hxDiab) score += 0; // informatif ici; à affiner selon RP

    const hypo = guess(zone, circ);

    if(score >= 7){
      result.innerHTML = `
        <p class="warn"><strong>Prudence :</strong> consultez un professionnel (médecin/urgences sans RDV) dans les <strong>24–48 h</strong>.</p>
        ${hypo? `<p>Hypothèses fréquentes : <em>${hypo}</em>.</p>`:''}
        ${selfCare(zone)}
      `;
    } else {
      result.innerHTML = `
        <p class="ok"><strong>Probablement bénin :</strong> vous pouvez débuter une prise en charge à domicile et surveiller pendant 48 h.</p>
        ${hypo? `<p>Hypothèses fréquentes : <em>${hypo}</em>.</p>`:''}
        ${selfCare(zone)}
      `;
    }
  }

  function labelFlag(key){(key){
    const map={
      saignement:'Saignement abondant',
      deformation:'Déformation évidente / os apparent',
      appui:"Impossible de marcher / s'appuyer",
      conscience:'Perte de connaissance / confusion',
      respir:'Difficulté à respirer / douleur thoracique',
      engourdissement:'Paralysie / engourdissement étendu'
    };
    return map[key]||key;
  }

  function guess(zone, circ){
    if(!zone) return '';
    const h = hypotheses[zone]||{};
    // take first matching circumstance suggestion
    for(const c of circ){
      if(h[c]) return h[c];
    }
    // fallback generic
    const generic = {
      'cheville_pied':'Entorse ou contusion',
      'genou':'Entorse ou contusion',
      'epaule_bras':'Contusion, luxation ou fracture',
      'poignet_main':'Entorse ou fracture',
      'dos':'Lombalgie mécanique',
      'hanche_cuisse':'Contusion ou déchirure',
      'tete':'Commotion / plaie',
      'cou':'Entorse cervicale',
      'thorax':'Contusion costale',
      'abdomen':'Contusion abdominale',
      'peau':'Plaie ou brûlure'
    };
    return generic[zone]||'';
  }

  function selfCare(zone){
    let tips = [
      'Repos relatif 24–48 h et immobiliser si besoin',
      'Glace 15–20 min, 3–4×/jour (protégée par un linge)',
      'Antalgiques usuels si pas de contre-indication',
      'Surveiller : douleur en hausse, fièvre, gonflement, perte de fonction'
    ];
    if(zone==='peau') tips = [
      'Nettoyer à l’eau et au savon, puis désinfecter',
      'Compression si saignement, pansement propre',
      'Brûlure : refroidir à l’eau tempérée 10–20 min',
      'Vérifier la vaccination antitétanique'
    ];
    return `<div class="panel"><strong>Conseils initiaux :</strong><ul class="list">${tips.map(t=>`<li>${t}</li>`).join('')}</ul></div>`;
  }

  document.getElementById('eval').addEventListener('click', evaluate);
  document.getElementById('reset').addEventListener('click', ()=>{ 
    document.querySelectorAll('input[type=checkbox]').forEach(i=> i.checked=false);
    locationEl.value='';
    pain.value=3; updateMeter();
    if(ageEl) ageEl.value='';
    if(delayEl) delayEl.value='';
    result.classList.add('muted');
    result.innerHTML='Renseignez les champs à gauche puis cliquez sur « Évaluer ».';
  });
    locationEl.value='';
    pain.value=3; updateMeter();
    result.classList.add('muted');
    result.innerHTML='Renseignez les champs à gauche puis cliquez sur « Évaluer ».';
  });
</script>
</body>
</html>
